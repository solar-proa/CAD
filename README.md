# Solar Proa

## About

The solar proa is a novel boat design for carbon-neutral
small-scale tropical maritime transport, exploration, and tourism.
These boats combine traditional Southeast Asian and Polynesian
boat designs and rigs with solar power and modern materials.
More on solar proas is available at the website
[https://solarproa.org](https://solarproa.org).

This repo generates the website, including the parametric boat designs
and validation.

## How this repo works

The boat models specified in this repo are available at
[https://solarproa.org](https://solarproa.org). Changes in the boat
specs here are automatically reflected in the website.

The boat designs are programmed in Python.
Design-specific components live in `src/` while boat-independent analysis is provided by the [shipshape](https://github.com/shipshape-marine/shipshape) library. Features include:
- Main macro: The boat designs are generated by the _Solar Proa Design Generator_, [`SolarProa.FCMacro`](https://github.com/shipshape-marine/solar-proa/blob/main/SolarProa.FCMacro) using [FreeCAD](https://www.freecad.org/).
- Parameters: The boat is fully parameterized; the files [`constant/boat/rp*.json`](https://github.com/shipshape-marine/solar-proa/tree/main/constant/boat/) let you choose the numbers of solar panels and the size of all components. SolarProa-specific derived parameters are computed by [`src/parameter/compute.py`](https://github.com/shipshape-marine/solar-proa/blob/main/src/parameter/compute.py), loaded as a plugin by `shipshape.parameter`.
- Configurations: Moving parts such as rig, sails, rudders etc can be configured in the files [`constant/configuration/*.json`](https://github.com/shipshape-marine/solar-proa/tree/main/constant/configuration), for example [`closehaul.json`](https://github.com/shipshape-marine/solar-proa/blob/main/constant/configuration/closehaul.json).
- Mirroring: Solar proas have a transversal symmetry axis. Most components are described in file [`mirror.py`](https://github.com/shipshape-marine/solar-proa/blob/main/src/design/mirror.py) and automatically mirrored in the generated model.
- Rotation: Some parts such as the rigs and rudder can be rotated or moved independently (see file [`rotation.py`](https://github.com/shipshape-marine/solar-proa/blob/main/src/design/rotation.py)) in the configuration files.
- Structural validation: The structural validation lives in [`src/structural/`](https://github.com/shipshape-marine/solar-proa/tree/main/src/structural) and covers aka, mast, spine, and capsize analysis.
- Validation: The validation of the designs with respect to their mechanical, electrical and naval-engineering integrity is automated and the website reflects the validation results of the latest designs.

### Repo structure

```
src/
  parameter/compute.py   SolarProa-specific derived parameter calculations
  design/                FreeCAD geometry generation (central, mirror, rotation)
  color/                 Apply colors to FreeCAD models
  render/                Render images from FreeCAD
  step/                  Export to STEP format
  lines/                 Generate lines plan drawings
  buoyancy_design/       Position the boat at equilibrium in FreeCAD
  structural/            Structural validation (aka, mast, spine, capsize)
constant/
  boat/                  Boat specifications (rp2.json, rp4.json, ...)
  configuration/         Sail/rudder configurations (closehaul.json, ...)
  material/              Material properties
```

Analysis is provided by [shipshape](https://github.com/shipshape-marine/shipshape): parameter computation, mass analysis, buoyancy equilibrium, and GZ curves.

## Getting Started

0. Install `git` and `make`:
- **Linux**: `sudo apt install git make` (Ubuntu/Debian) or `sudo dnf install git make` (Fedora/RHEL)
- **macOS**: [Install Git](https://git-scm.com/install/mac), then run `xcode-select --install` for `make`
- **Windows**: [Git for Windows](https://git-scm.com/download/win) (includes Git Bash with `make`)

1. Clone this repository with `git clone git@github.com:shipshape-marine/solar-proa.git`

2. Install [FreeCAD](https://www.freecad.org/)

3. Start FreeCAD

4. Macro > Macros, then choose the file `SolarProa.FCMacro`

5. In the Solar Proa Design Generator, choose the boat (e.g. RP2) and configuration (e.g. Closehaul).

6. You should see the design (e.g. `rp2.closehaul.design`) in the FreeCAD view.

## Playing with the FreeCAD models

Change the boat specifications and rerun the macro:
- Change `constant/boat/rp2.json` to play with the number of solar panels, length of the boat etc.
- Change `constant/configuration/closehaul.json` to play with the sail settings, rudder position etc.
- Add or change boat features by editing `src/design/central.py`, `src/design/mirror.py`, or `src/design/rotation.py` and rerun the macro.

## Generating `FCStd` and `step` files from command line

To generate all designs (all boats with all configurations) just type
```
make
```
To generate an individual design, type
```
make design BOAT=rp2 CONFIG=closehaul
```
or
```
make step BOAT=rp2 CONFIG=closehaul
```
The generated files are placed in the folder `artifact`, for example:
```
artifact/rp2.closehaul.design.FCStd
artifact/rp2.closehaul.step.step
```

## Continuous Integration/Continuous Deployment (CICD)

The issue: when we have an idea for an improvement of the design, we
would need to redo all changes in all affected artifacts: the designs,
renderings, validations, and websites. CICD takes care of that by
automatically regenerating the artifacts. This is done locally, using
the `make` facility and on the github server using a workflow. The
workflow makes sure that the [solarproa.org](https://solarproa.org)
website has always the latest versions.

## Under the hood

Crucial for the CICD approach to CAD using FreeCAD is:
- FreeCAD's [macros](https://wiki.freecad.org/Macros) feature
- the ability to run FreeCAD headlessly (with GUI), using `freecadcmd` on Linux and using `--console` on Mac
- this [observation](https://forum.freecad.org/viewtopic.php?p=857226#p857226) by FreeCAD user [`jcsahnwaldt`](https://forum.freecad.org/memberlist.php?mode=viewprofile&u=85580&sid=a9af5bd37412a3771f25378b4c027a2c) to use GUI features in headless FreeCAD with `PySide.QtGui`

Some design decisions:
- Toolchain automation with [`make`](<https://en.wikipedia.org/wiki/Make_(software)>) using this [Makefile](https://github.com/shipshape-marine/solar-proa/blob/main/Makefile)
- Website generation using [Jekyll](<https://en.wikipedia.org/wiki/Jekyll_(software)>)
- JSON statistics generated by headless FreeCAD
- Rendering by headless FreeCAD using [`jcsahnwaldt`](https://github.com/jcsahnwaldt)'s observation

## Further development

Let's explore what output formats we can generate and what tools are available to get the most out of our FreeCAD designs. Any contributions are welcome.
